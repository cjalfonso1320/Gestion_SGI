<link rel="stylesheet" href="{{ url_for('static', filename='css/home_admin.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/form_indicadores.css') }}">

<body class="darkmode">

    <!-- MENU LATERAL -->
    <nav class="main-menu">
        <div>
            <div class="user-info">
                <img src="{{ url_for('static', filename=imagen_rol) }}" alt="user" />
                <p>{{ usuario.name }}</p>
            </div>
        </div>
        <div>
            <ul>
                <li class="nav-item">
                    <a href="{{ url_for('doc.documentacion')}}" class="nav-link" data-section="documentacion">
                        <i class="fa-regular fa-file-lines nav-icon"></i>
                        <span class="nav-text">Documentacion</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('ind.indicadores')}}" class="nav-link" data-section="indicadores">
                        <i class="fa-solid fa-chart-line nav-icon"></i>
                        <span class="nav-text">Indicadores</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('usoInt.UsoInterno')}}" class="nav-link" data-section="uso-interno">
                        <i class="fa-solid fa-up-right-from-square nav-icon"></i>
                        <span class="nav-text">Informacion de Uso Interno</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('mRiesgos.Matriz_Riesgos', role_id=current_user.rol)}}" class="nav-link"
                        data-section="matriz-riesgos">
                        <i class="fa-solid fa-arrows-up-to-line nav-icon"></i>
                        <span class="nav-text">Matriz de Riesgos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('mActivos.Matriz_Activos')}}" class="nav-link" data-section="matriz-activos">
                        <i class="fa-solid fa-chart-line nav-icon"></i>
                        <span class="nav-text">Matriz de Activos</span>
                    </a>
                </li>
                {% if current_user.rol == 16 %}
                <li class="nav-item">
                    <a href="{{ url_for('lMaestra.Lista_Maestra')}}" class="nav-link" data-section="lista-maestra">
                        <i class="fa-solid fa-brain nav-icon"></i>
                        <span class="nav-text">Lista Maestra</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('control.control') }}" class="nav-link" data-section="control">
                        <i class="fa-solid fa-gamepad nav-icon"></i>
                        <span class="nav-text">Control</span>
                    </a>
                </li>
                {% endif %}

            </ul>
        </div>

        <ul>

            <li class="nav-item">
                <a href="{{ url_for('auth.logout') }}">
                    <i class="fa fa-right-from-bracket nav-icon"></i>
                    <span class="nav-text">Cerrar Sesion</span>
                </a>
            </li>
        </ul>
    </nav>
    <!-- FINALIZA MENU LATERAL -->

    <section class="content">
        <div class="left-content">

            <!-- MENU CENTRAL -->
            <div class="upcoming-events">
                {% if request.endpoint != 'home.home' %}
                <div style="margin-bottom: 20px;">
                    <a href="{{ url_for('home.home') }}" class="btn-10"
                        style="text-decoration: none; display: inline-block;">
                        <i class="fa fa-home"></i> Volver al Inicio
                    </a>
                </div>
                {% endif %}
                <div id="content-container">
                    <!-- PRESENTACION INICIAL -->
                    <div id="initial-presentation" class="initial-content" {% if request.endpoint !='home.home'
                        %}style="display: none;" {% endif %}>
                        <div class="welcome-section">
                            <h2>¡Bienvenido al Sistema de Gestión Integrado!</h2>
                            <p>Selecciona una opción del menú para comenzar a gestionar tu información.</p>

                            <div class="feature-grid">
                                <a href="{{ url_for('doc.documentacion')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Documentación</h3>
                                        <p>Gestiona toda la documentación del sistema</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('doc.documentacion2')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Documentación V2</h3>
                                        <p>Gestiona toda la documentación del sistema</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('ind.indicadores')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-solid fa-chart-line"></i>
                                        <h3>Indicadores</h3>
                                        <p>Visualiza y analiza los indicadores clave</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('usoInt.UsoInterno')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Uso Interno</h3>
                                        <p>Accede a información de uso interno</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('mRiesgos.Matriz_Riesgos')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Matriz de Riesgos</h3>
                                        <p>Gestiona y evalúa los riesgos del sistema</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('mActivos.Matriz_Activos')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Matriz de Activos</h3>
                                        <p>Administra los activos del sistema</p>
                                    </div>
                                </a>
                                {% if current_user.rol == 16 %}
                                <a href="{{ url_for('lMaestra.Lista_Maestra')}}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Lista Maestra</h3>
                                        <p>Gestiona la lista maestra de documentos</p>
                                    </div>
                                </a>
                                <a href="{{ url_for('control.control') }}" style="text-decoration: none;">
                                    <div class="feature-card">
                                        <i class="fa-regular fa-file-lines"></i>
                                        <h3>Control</h3>
                                        <p>Accede a las funciones de control</p>
                                    </div>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- CONTENIDO DINÁMICO -->
                    <div id="dynamic-content" class="dynamic-content" {% if request.endpoint !='home.home'
                        %}style="display: block;" {% endif %}>
                        {% block content %}
                        <!-- Contenido específico de cada página -->
                        {% endblock %}
                    </div>
                </div>
            </div>
            <!-- FINALIZA MENU CENTRAL -->
        </div>

        <!-- MENU DERECHA-CONTEOS -->
        <div class="right-content">
            <div class="analytics">
                <h1>Conteo</h1>
                <div class="analytics-container">
                    <div class="total-events">
                        <div class="event-number card">
                            {% if procesos is defined %}
                            <h2>Procesos</h2>
                                {% if procesos %}
                                {% for proceso in procesos %}
                                <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color); list-style: none;">
                                    <!-- Usamos .replace('_', ' ') para mostrar un nombre más legible -->
                                    {{ proceso.replace('_', ' ') }}
                                </li>
                                {% endfor %}
                                {% else %}
                                <p>no se han cargado procesos</p>
                                {% endif %}
                            {% endif %}
                            <i class="bx bx-check-circle"></i>
                        </div>
                    </div>
                    <br>
                    <div class="total-events{% if pendientes > 0 %} parpadea {% endif %}" id="openPendientesModal"
                        style="cursor:pointer;">
                        <div class="event-number card">
                            <h2>Pendientes por Aprobar</h2>
                            <p style="font-size: 2rem; margin-top: 8px;">{{ pendientes }}</p>
                        </div>
                    </div>
                    <br>
                    {% if current_user.rol != 16 %}
                    <div class="total-events{% if rechazados > 0 %} parpadea {% endif %}" id="openRechazadosModal"
                        style="cursor:pointer;">
                        <div class="event-number card">
                            <h2>Pendientes Rechazados</h2>
                            <p style="font-size: 2rem; margin-top: 8px;">{{ rechazados }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- FINALIZA MENU DERECHA -->
    </section>
    <!-- Modal personalizado -->
    <div id="pendientesModal" class="custom-modal">
        <div class="custom-modal-content">
            <span class="custom-modal-close" id="closePendientesModal">&times;</span>
            <h2>Pendientes por Aprobar</h2>
            <div class="feature-grid">
                <div>
                    {% for cambio_pendiente in cambios_pendientes %}
                    <div class="feature-card">
                        <i class="fa-regular fa-file-lines"></i>
                        <h3>Nombre del procedimiento: {{cambio_pendiente[8]}}</h3>
                        <p>Solicitante: {{cambio_pendiente[3]}}</p>
                        <p>Descripción del Cambio: {{cambio_pendiente[7]}}</p>
                        {% if current_user.rol in [16] %}
                        <form class="aprobacion-form" method="POST" action="{{ url_for('proc.aprobar_cambio') }}">
                            <input type="hidden" name="id" value="{{ cambio_pendiente[0] }}">
                            <input type="hidden" name="nombre_documento" value="{{ cambio_pendiente[8] }}">
                            <input type="hidden" name="version" value="{{ cambio_pendiente[2] }}">
                            <select class="form-label" name="aprobacion" id="aprobacion">
                                <option value="Aprobado">Aprobar</option>
                                <option value="Rechazado">Rechazar</option>
                            </select>
                            <button type="submit" class="btn-10">Enviar</button>
                        </form>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div id="rechazadosModal" class="custom-modal">
        <div class="custom-modal-content">
            <span class="custom-modal-close" id="closerechazadosModal">&times;</span>
            <h2>Rechazados</h2>
            <div class="feature-grid">
                <div>
                    {% for cambio_rechazado in cambios_rechazados %}
                    <div class="feature-card">
                        <i class="fa-regular fa-file-lines"></i>
                        <h3>Nombre del procedimiento: {{cambio_rechazado[8]}}</h3>
                        <p>Solicitante: {{cambio_rechazado[3]}}</p>
                        <p>Descripción del Cambio: {{cambio_rechazado[7]}}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    document.getElementById('openPendientesModal').onclick = function () {
        document.getElementById('pendientesModal').style.display = 'flex';
    };
    document.getElementById('closePendientesModal').onclick = function () {
        document.getElementById('pendientesModal').style.display = 'none';
    };
    // Cierra el modal al hacer click fuera del contenido
    window.onclick = function (event) {
        var modal = document.getElementById('pendientesModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    document.getElementById('openRechazadosModal').onclick = function () {
        document.getElementById('rechazadosModal').style.display = 'flex';
    };
    document.getElementById('closerechazadosModal').onclick = function () {
        document.getElementById('rechazadosModal').style.display = 'none';
    };
    // Cierra el modal al hacer click fuera del contenido
    window.onclick = function (event) {
        var modal = document.getElementById('rechazadosModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };
</script>
<script src="{{ url_for('static', filename='js/home_admin.js') }}"></script>